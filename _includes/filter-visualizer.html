<!-- MATLAB风格的交互式图表组件 -->
<div class="matlab-visualizer" id="filter-demo">
    <div class="controls">
        <h4>🔧 滤波器参数调节</h4>
        <div class="control-group">
            <label>截止频率 (Hz): <span id="fc-value">15</span></label>
            <input type="range" id="fc-slider" min="5" max="50" value="15" step="1">
        </div>
        <div class="control-group">
            <label>滤波器阶数: <span id="order-value">4</span></label>
            <input type="range" id="order-slider" min="1" max="8" value="4" step="1">
        </div>
        <div class="control-group">
            <label>噪声强度: <span id="noise-value">0.5</span></label>
            <input type="range" id="noise-slider" min="0" max="1" value="0.5" step="0.1">
        </div>
        <button onclick="updateFilter()" class="update-btn">🔄 更新滤波器</button>
    </div>
    
    <div class="chart-container">
        <canvas id="signal-chart" width="800" height="400"></canvas>
    </div>
    
    <div class="frequency-response">
        <canvas id="freq-chart" width="800" height="300"></canvas>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// 信号处理函数（简化版）
class FilterDemo {
    constructor() {
        this.fs = 1000;  // 采样频率
        this.t = [];
        this.signalClean = [];
        this.signalNoisy = [];
        this.signalFiltered = [];
        
        this.initTimeVector();
        this.initCharts();
        this.generateSignal();
    }
    
    initTimeVector() {
        for (let i = 0; i < 500; i++) {
            this.t.push(i / this.fs);
        }
    }
    
    generateSignal() {
        const fc = parseFloat(document.getElementById('fc-slider').value);
        const noiseLevel = parseFloat(document.getElementById('noise-slider').value);
        
        this.signalClean = [];
        this.signalNoisy = [];
        
        for (let i = 0; i < this.t.length; i++) {
            const clean = Math.sin(2 * Math.PI * 10 * this.t[i]);
            const noise = noiseLevel * (Math.random() - 0.5) * 2;
            
            this.signalClean.push(clean);
            this.signalNoisy.push(clean + noise);
        }
        
        this.applyFilter(fc);
        this.updateCharts();
    }
    
    // 简化的低通滤波器（移动平均近似）
    applyFilter(fc) {
        const windowSize = Math.max(1, Math.floor(this.fs / fc / 2));
        this.signalFiltered = [];
        
        for (let i = 0; i < this.signalNoisy.length; i++) {
            let sum = 0;
            let count = 0;
            
            for (let j = Math.max(0, i - windowSize); 
                 j <= Math.min(this.signalNoisy.length - 1, i + windowSize); j++) {
                sum += this.signalNoisy[j];
                count++;
            }
            
            this.signalFiltered.push(sum / count);
        }
    }
    
    initCharts() {
        // 时域信号图表
        const ctx1 = document.getElementById('signal-chart').getContext('2d');
        this.signalChart = new Chart(ctx1, {
            type: 'line',
            data: {
                labels: this.t.map(t => (t * 1000).toFixed(0)), // 转换为ms
                datasets: [{
                    label: '含噪声信号',
                    data: [],
                    borderColor: 'rgba(255, 107, 107, 0.8)',
                    backgroundColor: 'rgba(255, 107, 107, 0.1)',
                    borderWidth: 1,
                    pointRadius: 0
                }, {
                    label: '滤波后信号',
                    data: [],
                    borderColor: 'rgba(0, 212, 255, 1)',
                    backgroundColor: 'rgba(0, 212, 255, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0
                }, {
                    label: '原始信号',
                    data: [],
                    borderColor: 'rgba(16, 185, 129, 1)',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { 
                        title: { display: true, text: '时间 (ms)', color: '#ffffff' },
                        ticks: { color: '#a1a1aa' },
                        grid: { color: 'rgba(0, 212, 255, 0.1)' }
                    },
                    y: { 
                        title: { display: true, text: '幅度', color: '#ffffff' },
                        ticks: { color: '#a1a1aa' },
                        grid: { color: 'rgba(0, 212, 255, 0.1)' }
                    }
                },
                plugins: {
                    legend: { 
                        labels: { color: '#ffffff' }
                    },
                    title: {
                        display: true,
                        text: '信号滤波效果对比',
                        color: '#00d4ff',
                        font: { size: 16 }
                    }
                }
            }
        });
        
        // 频率响应图表
        const ctx2 = document.getElementById('freq-chart').getContext('2d');
        this.freqChart = new Chart(ctx2, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: '滤波器频率响应',
                    data: [],
                    borderColor: 'rgba(124, 58, 237, 1)',
                    backgroundColor: 'rgba(124, 58, 237, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { 
                        title: { display: true, text: '频率 (Hz)', color: '#ffffff' },
                        ticks: { color: '#a1a1aa' },
                        grid: { color: 'rgba(0, 212, 255, 0.1)' }
                    },
                    y: { 
                        title: { display: true, text: '幅度 (dB)', color: '#ffffff' },
                        ticks: { color: '#a1a1aa' },
                        grid: { color: 'rgba(0, 212, 255, 0.1)' }
                    }
                },
                plugins: {
                    legend: { 
                        labels: { color: '#ffffff' }
                    },
                    title: {
                        display: true,
                        text: '滤波器频率响应',
                        color: '#00d4ff',
                        font: { size: 16 }
                    }
                }
            }
        });
    }
    
    updateCharts() {
        // 更新信号图表
        this.signalChart.data.datasets[0].data = this.signalNoisy;
        this.signalChart.data.datasets[1].data = this.signalFiltered;
        this.signalChart.data.datasets[2].data = this.signalClean;
        this.signalChart.update();
        
        // 更新频率响应图表
        this.updateFrequencyResponse();
    }
    
    updateFrequencyResponse() {
        const fc = parseFloat(document.getElementById('fc-slider').value);
        const freqs = [];
        const response = [];
        
        for (let f = 1; f <= 100; f++) {
            freqs.push(f);
            // 简化的一阶低通滤波器响应
            const magnitude = 1 / Math.sqrt(1 + Math.pow(f / fc, 2));
            response.push(20 * Math.log10(magnitude)); // 转换为dB
        }
        
        this.freqChart.data.labels = freqs;
        this.freqChart.data.datasets[0].data = response;
        this.freqChart.update();
    }
}

// 初始化
let filterDemo;
document.addEventListener('DOMContentLoaded', function() {
    filterDemo = new FilterDemo();
});

// 控制函数
function updateFilter() {
    const fc = document.getElementById('fc-slider').value;
    const order = document.getElementById('order-slider').value;
    const noise = document.getElementById('noise-slider').value;
    
    document.getElementById('fc-value').textContent = fc;
    document.getElementById('order-value').textContent = order;
    document.getElementById('noise-value').textContent = noise;
    
    filterDemo.generateSignal();
}

// 滑块事件监听
document.addEventListener('DOMContentLoaded', function() {
    const sliders = ['fc-slider', 'order-slider', 'noise-slider'];
    sliders.forEach(id => {
        document.getElementById(id).addEventListener('input', updateFilter);
    });
});
</script>

<style>
.matlab-visualizer {
    background: var(--bg-secondary);
    border-radius: var(--border-radius);
    padding: 2rem;
    margin: 2rem 0;
    border: 1px solid rgba(0, 212, 255, 0.2);
}

.controls {
    background: var(--bg-tertiary);
    padding: 1.5rem;
    border-radius: var(--border-radius-sm);
    margin-bottom: 2rem;
}

.controls h4 {
    color: var(--primary-color);
    margin-bottom: 1rem;
    font-family: var(--font-mono);
}

.control-group {
    margin-bottom: 1rem;
}

.control-group label {
    display: block;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.control-group input[type="range"] {
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: var(--bg-primary);
    outline: none;
    -webkit-appearance: none;
}

.control-group input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--primary-color);
    cursor: pointer;
    box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
}

.update-btn {
    background: var(--primary-color);
    color: var(--bg-primary);
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 4px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 1rem;
}

.update-btn:hover {
    background: var(--accent-color);
    box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
}

.chart-container, .frequency-response {
    background: var(--bg-tertiary);
    border-radius: var(--border-radius-sm);
    padding: 1rem;
    margin-bottom: 1rem;
    position: relative;
    height: 400px;
}

.frequency-response {
    height: 300px;
}

#signal-chart, #freq-chart {
    width: 100% !important;
    height: 100% !important;
}
</style>