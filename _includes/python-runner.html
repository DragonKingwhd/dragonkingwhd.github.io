<!-- 交互式Python代码运行器 -->
<div class="code-runner" id="python-runner">
    <div class="code-editor">
        <textarea id="python-code" rows="15" cols="80">
import numpy as np
import matplotlib.pyplot as plt
from scipy.signal import butter, filtfilt

# 信号滤波示例
t = np.arange(0, 1, 0.001)
signal_clean = np.sin(2*np.pi*10*t)
noise = 0.5*np.random.randn(len(t))
signal_noisy = signal_clean + noise

# 设计滤波器
fs = 1000
fc = 15
b, a = butter(4, fc/(fs/2), btype='low')
signal_filtered = filtfilt(b, a, signal_noisy)

# 绘图
plt.figure(figsize=(10, 6))
plt.subplot(2,1,1)
plt.plot(t[:500], signal_noisy[:500], alpha=0.7, label='含噪声信号')
plt.plot(t[:500], signal_clean[:500], 'r-', linewidth=2, label='原始信号')
plt.legend()
plt.title('滤波前')

plt.subplot(2,1,2) 
plt.plot(t[:500], signal_filtered[:500], 'g-', linewidth=2, label='滤波后')
plt.plot(t[:500], signal_clean[:500], 'r--', alpha=0.5, label='原始信号')
plt.legend()
plt.title('滤波后')
plt.tight_layout()
plt.show()
        </textarea>
    </div>
    <button onclick="runPythonCode()" class="run-btn">🚀 运行代码</button>
    <div id="python-output"></div>
</div>

<script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
<script>
async function main() {
    let pyodide = await loadPyodide();
    await pyodide.loadPackage(["numpy", "scipy", "matplotlib"]);
    
    window.runPythonCode = function() {
        const code = document.getElementById('python-code').value;
        const output = document.getElementById('python-output');
        
        try {
            pyodide.runPython(`
import sys
from io import StringIO
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
import base64
from io import BytesIO

# 重定向输出
old_stdout = sys.stdout
sys.stdout = mystdout = StringIO()

# 运行用户代码
${code}

# 保存图片为base64
buf = BytesIO()
plt.savefig(buf, format='png', dpi=100, bbox_inches='tight')
buf.seek(0)
import base64
img_str = base64.b64encode(buf.read()).decode()

# 恢复输出
sys.stdout = old_stdout
print_output = mystdout.getvalue()
            `);
            
            const imgStr = pyodide.globals.get('img_str');
            const printOutput = pyodide.globals.get('print_output');
            
            output.innerHTML = `
                <div class="output-text">${printOutput}</div>
                <img src="data:image/png;base64,${imgStr}" style="max-width: 100%; height: auto;">
            `;
        } catch (err) {
            output.innerHTML = `<div class="error">错误: ${err}</div>`;
        }
    };
}

main();
</script>

<style>
.code-runner {
    background: var(--bg-secondary);
    border-radius: var(--border-radius);
    padding: 1.5rem;
    margin: 2rem 0;
    border: 1px solid rgba(0, 212, 255, 0.2);
}

.code-editor textarea {
    width: 100%;
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border: 1px solid rgba(0, 212, 255, 0.3);
    border-radius: 4px;
    padding: 1rem;
    font-family: var(--font-mono);
    font-size: 0.9rem;
    resize: vertical;
}

.run-btn {
    background: var(--primary-color);
    color: var(--bg-primary);
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 4px;
    font-weight: 600;
    cursor: pointer;
    margin: 1rem 0;
    transition: all 0.3s ease;
}

.run-btn:hover {
    background: var(--accent-color);
    box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
}

#python-output {
    background: var(--bg-tertiary);
    border-radius: 4px;
    padding: 1rem;
    margin-top: 1rem;
    min-height: 100px;
    color: var(--text-primary);
}

.output-text {
    color: var(--text-secondary);
    font-family: var(--font-mono);
    margin-bottom: 1rem;
    white-space: pre-wrap;
}

.error {
    color: var(--danger-color);
    font-family: var(--font-mono);
}
</style>