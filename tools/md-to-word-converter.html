---
layout: default
title: Markdown to Word è½¬æ¢å™¨
permalink: /tools/md-to-word-converter/
---

<div class="page-header">
    <div class="container">
        <h1 class="page-title">Markdown to Word è½¬æ¢å™¨</h1>
        <p class="page-subtitle">å°†æ‚¨çš„ Markdown æ–‡ä»¶å¿«é€Ÿè½¬æ¢ä¸ºä¸“ä¸šçš„ Word æ–‡æ¡£</p>
    </div>
</div>

<section class="content-section">
    <div class="container">
        <div class="tool-converter">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“</div>
                <div class="upload-text">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½ MD æ–‡ä»¶åˆ°æ­¤å¤„</div>
                <div class="upload-hint">æ”¯æŒ .md, .markdown æ ¼å¼</div>
                <input type="file" id="fileInput" accept=".md,.markdown" style="display: none;" />
            </div>
            
            <div class="file-info" id="fileInfo" style="display: none;">
                <div class="file-name" id="fileName"></div>
                <div class="file-size" id="fileSize"></div>
            </div>
            
            <div class="progress" id="progress" style="display: none;">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div class="preview-area" id="previewArea" style="display: none;">
                <div class="preview-header">Markdown é¢„è§ˆ</div>
                <div class="preview-content" id="previewContent"></div>
            </div>
            
            <div class="converter-actions">
                <button class="btn btn-primary" id="convertBtn" disabled>ğŸ”„ è½¬æ¢ä¸º Word</button>
                <button class="btn btn-success" id="downloadBtn" style="display: none;">ğŸ’¾ ä¸‹è½½ Word æ–‡æ¡£</button>
            </div>
        </div>
        
        <div class="tool-features">
            <h3>åŠŸèƒ½ç‰¹è‰²</h3>
            <div class="grid grid-3">
                <div class="feature-card">
                    <i class="fas fa-file-alt"></i>
                    <h4>æ ¼å¼ä¿ç•™</h4>
                    <p>å®Œæ•´ä¿ç•™æ ‡é¢˜å±‚çº§ã€åˆ—è¡¨ã€è¡¨æ ¼ã€å¼•ç”¨ç­‰æ‰€æœ‰Markdownæ ¼å¼</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-palette"></i>
                    <h4>ä¸“ä¸šæ ·å¼</h4>
                    <p>è‡ªåŠ¨åº”ç”¨ä¸“ä¸šçš„Wordæ–‡æ¡£æ ·å¼ï¼Œé€‚åˆæŠ¥å‘Šå’Œæ–‡æ¡£åˆ¶ä½œ</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-shield-alt"></i>
                    <h4>æœ¬åœ°å¤„ç†</h4>
                    <p>æ‰€æœ‰è½¬æ¢åœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆï¼Œä¿æŠ¤æ‚¨çš„æ–‡æ¡£éšç§å’Œå®‰å…¨</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-cloud"></i>
                    <h4>åœ¨çº¿å¯ç”¨</h4>
                    <p>æ— éœ€å®‰è£…ä»»ä½•è½¯ä»¶ï¼Œä»»ä½•è®¾å¤‡ä¸Šæ‰“å¼€æµè§ˆå™¨å³å¯ä½¿ç”¨</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-mobile-alt"></i>
                    <h4>è·¨å¹³å°æ”¯æŒ</h4>
                    <p>æ”¯æŒWindowsã€Macã€Linuxã€æ‰‹æœºç­‰æ‰€æœ‰ç°ä»£æµè§ˆå™¨</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-bolt"></i>
                    <h4>å¿«é€Ÿè½¬æ¢</h4>
                    <p>åŸºäºæœ€æ–°WebæŠ€æœ¯ï¼Œè½¬æ¢é€Ÿåº¦å¿«ï¼Œæ”¯æŒå¤§æ–‡æ¡£å¤„ç†</p>
                </div>
            </div>
        </div>
        
        <div class="usage-guide">
            <h3>ä½¿ç”¨æŒ‡å—</h3>
            <div class="guide-steps">
                <div class="step">
                    <span class="step-number">1</span>
                    <h4>é€‰æ‹©æ–‡ä»¶</h4>
                    <p>ç‚¹å‡»ä¸Šæ–¹åŒºåŸŸæˆ–æ‹–æ‹½.md/.markdownæ–‡ä»¶åˆ°è½¬æ¢åŒºåŸŸ</p>
                </div>
                <div class="step">
                    <span class="step-number">2</span>
                    <h4>é¢„è§ˆå†…å®¹</h4>
                    <p>ç³»ç»Ÿä¼šè‡ªåŠ¨é¢„è§ˆMarkdownå†…å®¹ï¼Œç¡®è®¤æ ¼å¼æ­£ç¡®</p>
                </div>
                <div class="step">
                    <span class="step-number">3</span>
                    <h4>ä¸€é”®è½¬æ¢</h4>
                    <p>ç‚¹å‡»"è½¬æ¢ä¸ºWord"æŒ‰é’®ï¼Œç­‰å¾…å¤„ç†å®Œæˆ</p>
                </div>
                <div class="step">
                    <span class="step-number">4</span>
                    <h4>ä¸‹è½½æ–‡æ¡£</h4>
                    <p>è½¬æ¢å®Œæˆåç‚¹å‡»ä¸‹è½½æŒ‰é’®ï¼Œä¿å­˜Wordæ–‡æ¡£</p>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
.tool-converter {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 2rem;
    box-shadow: var(--shadow-soft);
    margin-bottom: 2rem;
}

.upload-area {
    border: 2px dashed rgba(0, 212, 255, 0.3);
    border-radius: 12px;
    padding: 3rem 2rem;
    text-align: center;
    margin-bottom: 2rem;
    transition: all 0.3s ease;
    cursor: pointer;
    background: rgba(0, 212, 255, 0.05);
}

.upload-area:hover {
    border-color: var(--primary-color);
    background: rgba(0, 212, 255, 0.1);
    transform: translateY(-2px);
}

.upload-area.dragover {
    border-color: var(--primary-color);
    background: rgba(0, 212, 255, 0.15);
    transform: scale(1.02);
}

.upload-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.upload-text {
    font-size: 1.2rem;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.upload-hint {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.file-info {
    background: rgba(0, 212, 255, 0.1);
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    border-left: 4px solid var(--primary-color);
}

.file-name {
    font-weight: bold;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
}

.file-size {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.progress {
    width: 100%;
    height: 8px;
    background: rgba(0, 212, 255, 0.2);
    border-radius: 4px;
    overflow: hidden;
    margin: 1.5rem 0;
}

.progress-bar {
    height: 100%;
    background: var(--gradient-primary);
    width: 0%;
    transition: width 0.3s ease;
    border-radius: 4px;
}

.preview-area {
    margin: 2rem 0;
}

.preview-header {
    background: var(--card-bg);
    padding: 1rem;
    border-radius: 8px 8px 0 0;
    border: 1px solid rgba(0, 212, 255, 0.2);
    border-bottom: none;
    font-weight: bold;
    color: var(--text-primary);
}

.preview-content {
    border: 1px solid rgba(0, 212, 255, 0.2);
    border-radius: 0 0 8px 8px;
    padding: 1.5rem;
    max-height: 400px;
    overflow-y: auto;
    background: var(--bg-primary);
    font-size: 0.9rem;
}

.converter-actions {
    text-align: center;
    margin: 2rem 0;
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

.tool-features {
    margin-top: 3rem;
}

.tool-features h3 {
    text-align: center;
    margin-bottom: 2rem;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-size: 1.5rem;
}

.grid-3 {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.feature-card {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
    transition: transform 0.2s ease;
    border: 1px solid rgba(0, 212, 255, 0.1);
}

.feature-card:hover {
    transform: translateY(-4px);
}

.feature-card i {
    font-size: 2rem;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1rem;
    display: block;
}

.feature-card h4 {
    color: var(--text-primary);
    margin-bottom: 0.75rem;
    font-size: 1.1rem;
}

.feature-card p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    line-height: 1.5;
}

.usage-guide {
    margin-top: 3rem;
    background: rgba(0, 212, 255, 0.05);
    padding: 2rem;
    border-radius: 12px;
    border: 1px solid rgba(0, 212, 255, 0.1);
}

.usage-guide h3 {
    text-align: center;
    margin-bottom: 2rem;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-size: 1.5rem;
}

.guide-steps {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}

.step {
    text-align: center;
    padding: 1rem;
}

.step-number {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--gradient-primary);
    color: white;
    border-radius: 50%;
    font-weight: bold;
    font-size: 1.2rem;
    margin-bottom: 1rem;
}

.step h4 {
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
}

.step p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    line-height: 1.4;
}

@media (max-width: 768px) {
    .tool-converter {
        padding: 1.5rem;
    }
    
    .upload-area {
        padding: 2rem 1rem;
    }
    
    .converter-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .btn {
        width: 100%;
        max-width: 250px;
    }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/marked@9.1.2/marked.min.js"></script>
<script src="https://unpkg.com/docx@8.2.2/build/index.js"></script>
<script>
// æ£€æŸ¥å¿…è¦çš„åº“æ˜¯å¦åŠ è½½æˆåŠŸ
window.addEventListener('load', function() {
    if (typeof marked === 'undefined') {
        alert('âš ï¸ Markdownè§£æåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ååˆ·æ–°é¡µé¢');
        return;
    }
    if (typeof docx === 'undefined') {
        alert('âš ï¸ Wordç”Ÿæˆåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ååˆ·æ–°é¡µé¢');
        return;
    }
    console.log('âœ… æ‰€æœ‰å¿…è¦åº“å·²åŠ è½½å®Œæˆ');
});

let currentFile = null;
let convertedBlob = null;

const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');
const fileInfo = document.getElementById('fileInfo');
const fileName = document.getElementById('fileName');
const fileSize = document.getElementById('fileSize');
const previewArea = document.getElementById('previewArea');
const previewContent = document.getElementById('previewContent');
const convertBtn = document.getElementById('convertBtn');
const downloadBtn = document.getElementById('downloadBtn');
const progress = document.getElementById('progress');
const progressBar = document.getElementById('progressBar');

// æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
uploadArea.addEventListener('click', () => fileInput.click());
uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.classList.add('dragover');
});
uploadArea.addEventListener('dragleave', () => {
    uploadArea.classList.remove('dragover');
});
uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0) handleFile(files[0]);
});

fileInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) handleFile(e.target.files[0]);
});

function handleFile(file) {
    if (!file.name.match(/\.(md|markdown)$/i)) {
        alert('è¯·é€‰æ‹© Markdown æ–‡ä»¶ (.md æˆ– .markdown)');
        return;
    }

    currentFile = file;
    
    // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
    fileName.textContent = file.name;
    fileSize.textContent = formatFileSize(file.size);
    fileInfo.style.display = 'block';

    // è¯»å–å¹¶é¢„è§ˆæ–‡ä»¶
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            let markdownContent = e.target.result;
            
            // ä½¿ç”¨åŒæ ·çš„æ¸…ç†é€»è¾‘
            markdownContent = cleanMarkdownContent(markdownContent);
            
            const htmlContent = marked.parse(markdownContent);
            
            previewContent.innerHTML = htmlContent;
            previewArea.style.display = 'block';
            convertBtn.disabled = false;
        } catch (error) {
            console.error('é¢„è§ˆé”™è¯¯:', error);
            previewContent.innerHTML = '<p style="color: #e74c3c;">æ–‡ä»¶é¢„è§ˆå¤±è´¥ï¼Œä½†ä»å¯å°è¯•è½¬æ¢</p>';
            previewArea.style.display = 'block';
            convertBtn.disabled = false;
        }
    };
    reader.readAsText(file);
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

convertBtn.addEventListener('click', convertToWord);
downloadBtn.addEventListener('click', downloadWord);

function convertToWord() {
    if (!currentFile) return;

    progress.style.display = 'block';
    convertBtn.disabled = true;
    
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            updateProgress(25);
            let markdownContent = e.target.result;
            
            // æ¸…ç†å’Œé¢„å¤„ç†å†…å®¹
            markdownContent = cleanMarkdownContent(markdownContent);
            
            updateProgress(50);
            
            // ä½¿ç”¨æ–°çš„docxåº“è½¬æ¢
            convertWithDocx(markdownContent);
            
        } catch (error) {
            console.error('è½¬æ¢é”™è¯¯è¯¦æƒ…:', error);
            let errorMsg = 'è½¬æ¢å¤±è´¥ã€‚é”™è¯¯ä¿¡æ¯ï¼š' + (error.message || 'æœªçŸ¥é”™è¯¯');
            alert(errorMsg);
            convertBtn.disabled = false;
            progress.style.display = 'none';
        }
    };
    reader.readAsText(currentFile);
}

function convertWithDocx(markdownContent) {
    try {
        updateProgress(60);
        
        // æ£€æŸ¥å¿…è¦çš„åº“
        if (typeof marked === 'undefined' || typeof docx === 'undefined') {
            throw new Error('å¿…è¦çš„è½¬æ¢åº“æœªåŠ è½½å®Œæˆï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
        }
        
        // è§£æmarkdownç»“æ„
        const tokens = marked.lexer(markdownContent);
        console.log('Markdown tokens:', tokens);
        
        updateProgress(70);
        
        // åˆ›å»ºæ–‡æ¡£ç»“æ„
        const children = [];
        let processedTokens = 0;
        
        tokens.forEach((token, index) => {
            try {
                console.log(`Processing token ${index}:`, token.type, token);
                const elements = processToken(token);
                children.push(...elements);
                processedTokens++;
            } catch (tokenError) {
                console.warn(`Token ${index} å¤„ç†é”™è¯¯:`, tokenError, token);
                // è·³è¿‡æœ‰é—®é¢˜çš„tokenï¼Œç»§ç»­å¤„ç†
            }
        });
        
        if (processedTokens === 0) {
            throw new Error('æ–‡æ¡£è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥Markdownæ ¼å¼');
        }
        
        updateProgress(80);
        
        // åˆ›å»ºWordæ–‡æ¡£
        const doc = new docx.Document({
            sections: [{
                properties: {
                    page: {
                        margin: {
                            top: 1440,    // 1è‹±å¯¸ = 1440 twips
                            right: 1440,
                            bottom: 1440,
                            left: 1440,
                        },
                    },
                },
                children: children
            }]
        });
        
        updateProgress(90);
        
        // ç”Ÿæˆå¹¶ä¸‹è½½
        docx.Packer.toBlob(doc).then(blob => {
            if (!blob || blob.size === 0) {
                throw new Error('ç”Ÿæˆçš„Wordæ–‡æ¡£ä¸ºç©º');
            }
            
            convertedBlob = blob;
            updateProgress(100);
            
            setTimeout(() => {
                progress.style.display = 'none';
                downloadBtn.style.display = 'inline-block';
                convertBtn.disabled = false;
                
                // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
                const successMsg = `ğŸ‰ è½¬æ¢æˆåŠŸï¼\nğŸ“„ å¤„ç†äº† ${processedTokens} ä¸ªæ–‡æ¡£å…ƒç´ \nğŸ’¾ æ–‡ä»¶å¤§å°: ${formatFileSize(blob.size)}`;
                alert(successMsg);
            }, 500);
        }).catch(packError => {
            console.error('æ‰“åŒ…é”™è¯¯:', packError);
            alert('è½¬æ¢å¤±è´¥ï¼šWordæ–‡æ¡£ç”Ÿæˆæ—¶å‡ºé”™\n' + 
                  'å¯èƒ½åŸå› ï¼š\nâ€¢ æ–‡æ¡£å†…å®¹è¿‡äºå¤æ‚\nâ€¢ ç½‘ç»œè¿æ¥é—®é¢˜\nâ€¢ æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜\n\n' +
                  'å»ºè®®ï¼šå°è¯•ç®€åŒ–Markdownå†…å®¹æˆ–ä½¿ç”¨Chrome/Firefoxæµè§ˆå™¨');
            convertBtn.disabled = false;
            progress.style.display = 'none';
        });
        
    } catch (error) {
        console.error('DOCXè½¬æ¢é”™è¯¯:', error);
        alert('ğŸš¨ è½¬æ¢å¤±è´¥ï¼š' + (error.message || 'æœªçŸ¥é”™è¯¯') + 
              '\n\nğŸ’¡ å»ºè®®æ£€æŸ¥ï¼š\nâ€¢ ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸\nâ€¢ æ–‡æ¡£æ ¼å¼æ˜¯å¦æ­£ç¡®\nâ€¢ æµè§ˆå™¨æ˜¯å¦æ”¯æŒæœ€æ–°æ ‡å‡†');
        convertBtn.disabled = false;
        progress.style.display = 'none';
    }
}

function processToken(token) {
    const elements = [];
    
    switch (token.type) {
        case 'heading':
            elements.push(new docx.Paragraph({
                text: cleanText(token.text),
                heading: getHeadingLevel(token.depth),
                spacing: { after: 200 }
            }));
            break;
            
        case 'paragraph':
            elements.push(new docx.Paragraph({
                children: [new docx.TextRun(cleanText(token.text))],
                spacing: { after: 200 }
            }));
            break;
            
        case 'list':
            if (token.items) {
                token.items.forEach((item, index) => {
                    const itemText = typeof item === 'string' ? item : (item.text || '');
                    elements.push(new docx.Paragraph({
                        text: cleanText(itemText),
                        bullet: { level: 0 },
                        spacing: { after: 100 }
                    }));
                });
            }
            break;
            
        case 'table':
            const tableRows = [];
            
            // è¡¨å¤´
            if (token.header && token.header.length > 0) {
                const headerCells = token.header.map(cell => 
                    new docx.TableCell({
                        children: [new docx.Paragraph(cleanText(cell))],
                        shading: { fill: "f0f0f0" }
                    })
                );
                tableRows.push(new docx.TableRow({ children: headerCells }));
            }
            
            // è¡¨æ ¼å†…å®¹
            if (token.rows) {
                token.rows.forEach(row => {
                    const cells = row.map(cell => 
                        new docx.TableCell({
                            children: [new docx.Paragraph(cleanText(cell))]
                        })
                    );
                    tableRows.push(new docx.TableRow({ children: cells }));
                });
            }
            
            if (tableRows.length > 0) {
                elements.push(new docx.Table({
                    rows: tableRows,
                    width: { size: 100, type: docx.WidthType.PERCENTAGE }
                }));
            }
            break;
            
        case 'blockquote':
            elements.push(new docx.Paragraph({
                text: cleanText(token.text),
                indent: { left: 720 },
                italics: true,
                spacing: { after: 200 }
            }));
            break;
            
        case 'code':
            elements.push(new docx.Paragraph({
                children: [new docx.TextRun({
                    text: cleanText(token.text),
                    font: "Consolas"
                })],
                shading: { fill: "f5f5f5" },
                spacing: { after: 200 }
            }));
            break;
            
        case 'hr':
            elements.push(new docx.Paragraph({
                children: [new docx.TextRun("___")],
                alignment: docx.AlignmentType.CENTER,
                spacing: { after: 200 }
            }));
            break;
            
        case 'space':
            // è·³è¿‡ç©ºè¡Œ
            break;
            
        default:
            // å¤„ç†å…¶ä»–ç±»å‹çš„token
            if (token.text) {
                elements.push(new docx.Paragraph({
                    children: [new docx.TextRun(cleanText(token.text))],
                    spacing: { after: 200 }
                }));
            }
    }
    
    return elements;
}

function getHeadingLevel(depth) {
    const levels = {
        1: docx.HeadingLevel.HEADING_1,
        2: docx.HeadingLevel.HEADING_2,
        3: docx.HeadingLevel.HEADING_3,
        4: docx.HeadingLevel.HEADING_4,
        5: docx.HeadingLevel.HEADING_5,
        6: docx.HeadingLevel.HEADING_6
    };
    return levels[depth] || docx.HeadingLevel.HEADING_6;
}

function cleanText(text) {
    if (!text) return '';
    
    // ç¡®ä¿è¾“å…¥æ˜¯å­—ç¬¦ä¸²
    if (typeof text !== 'string') {
        text = String(text);
    }
    
    try {
        // ç§»é™¤HTMLæ ‡ç­¾å’ŒMarkdownæ ‡è®°
        return text
            .replace(/<[^>]*>/g, '')
            .replace(/\*\*(.*?)\*\*/g, '$1')
            .replace(/\*(.*?)\*/g, '$1')
            .replace(/`(.*?)`/g, '$1')
            .replace(/\[(.*?)\]\(.*?\)/g, '$1')
            .trim();
    } catch (error) {
        console.warn('æ–‡æœ¬æ¸…ç†å‡ºé”™:', error, 'text:', text);
        return String(text).trim();
    }
}

function cleanMarkdownContent(content) {
    try {
        // ç§»é™¤æˆ–æ›¿æ¢å¯èƒ½å¼•èµ·é—®é¢˜çš„å­—ç¬¦
        content = content
            // ç§»é™¤BOM
            .replace(/^\uFEFF/, '')
            // æ ‡å‡†åŒ–æ¢è¡Œç¬¦
            .replace(/\r\n/g, '\n')
            .replace(/\r/g, '\n')
            // ç§»é™¤æ§åˆ¶å­—ç¬¦ï¼ˆä¿ç•™åˆ¶è¡¨ç¬¦å’Œæ¢è¡Œç¬¦ï¼‰
            .replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g, '')
            // ä¿®å¤å¯èƒ½çš„ç¼–ç é—®é¢˜
            .replace(/[""]/g, '"')
            .replace(/['']/g, "'");
        
        return content;
    } catch (error) {
        console.warn('å†…å®¹æ¸…ç†è¿‡ç¨‹å‡ºé”™:', error);
        return content;
    }
}

function updateProgress(percent) {
    progressBar.style.width = percent + '%';
}

function downloadWord() {
    if (!convertedBlob) return;
    
    const url = URL.createObjectURL(convertedBlob);
    const a = document.createElement('a');
    a.href = url;
    a.download = currentFile.name.replace(/\.(md|markdown)$/i, '.docx');
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}
</script>